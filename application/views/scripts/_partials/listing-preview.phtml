<div class="listing-preview">


    <?php
    if (!$this->acc instanceof My_Houseshare_Accommodation) {
        $this->acc = My_Houseshare_Factory::accommodation($this->acc->acc_id);
    }
    ?>

    <?php
    $firstThumbPath = $this->baseUrl('/images/thumbs/no_pic.jpg');

    if (count($this->acc->photos) > 0) {
        $urls = $this->acc->thumbsurls;
        $firstThumbPath = array_shift($urls);
    }
    ?>
    <div class='listing-preview-img'>
        <a href="<?php echo $this->accUrl($this->acc); ?>">
            <img src="<?php echo $firstThumbPath; ?>" alt="Thumb image" class="thumb" height="90px"  />
        </a>
    </div>
    <div class="listing-preview-detials" style="float:left">
        <h1 class="advert-title">
            <?php $city = $this->acc->city; ?>
            <a class="city" href="<?php echo $this->baseUrl('/accommodation/list/city/' . $this->acc->address->city_id); ?>"><?php echo $city . ':'; ?></a>
            <a href="<?php echo $this->accUrl($this->acc); ?>">
                <?php echo  $this->truncate(ucfirst(strtolower($this->acc->title)), 0, 50); ?>
            </a>
             <a id="aID<?php echo $this->acc->acc_id; ?>" href="">
                <img src="<?php echo $this->baseUrl('/images/preview-icon.gif'); ?>" title="Quick preview" alt="Preview" />
            </a>
        </h1>        
        <div class="advert-info" >

            <div> <span class="listing-preview-type" title="<?php echo $this->acc->getTypeAsString(); ?>">
            <?php echo $this->acc->getTypeAsCharacter(); ?></span>
            <span class="listing-preview-description" ><?php echo $this->truncate($this->acc->description, 0, 155); ?></span>
            </div>               
            <dl>
                <?php // $city = $this->acc->city; ?>
              
                <dt>Avaliable <?php echo $this->avaliable($this->acc)->inOrFrom(); ?>: </dt>

                <dd>                 
                    <?php echo $this->avaliable($this->acc)->time(); ?>
                </dd> 
            </dl>
            <dl class="advert-stats">
                <dt>Added: </dt><dd><?php echo $this->timeSince($this->acc->creationtimestamp) . ' ago by ' . $this->acc->user->nickname; ?></dd> 
                <dt>Views: </dt><dd><?php echo $this->acc->views_count; ?></dd> 
                <dt>Queries sent: </dt><dd><?php echo 5; ?></dd>                                                           
            </dl>
        </div>
    </div>
    <div class="listing-preview-price">
        <p class="value"><?php echo $this->acc->price; ?></p>
        <p><?php echo $this->translate('Per month'); ?></p>
    </div>


    <!-- div used for jquery ui dialog preview of advertisment -->    
    <div id="dialogDiv<?php echo $this->acc->acc_id; ?>"></div>
    <script>
        $(function() {
            
            
        
        }
    );
    </script>

    <div style="float:clear"></div>

    <?php
    // get marker lat and lng values if possible
    $lat = $this->acc->address->lat;
    $lng = $this->acc->address->lng;
    $label = '';

    if ('index' == $this->action()) {
        $label = $this->acc->city;
    } else if ('list' == $this->action()) {
        $label = $this->acc->address->street;
    }



    echo '<input type="hidden" id="acc_id" value="' . $this->acc->acc_id . '" />';
    echo '<input type="hidden" id="type_id" value="' . $this->acc->type_id . '" />';
    echo '<input type="hidden" id="baseUrl" value="' . $this->baseUrl('/') . '" />';
    
    if (!empty($lat) && !empty($lng)) {
        echo '<input type="hidden" id="addr_lat" value="' . $lat . '" />';
        echo '<input type="hidden" id="addr_lng" value="' . $lng . '" />';
        echo '<input type="hidden" id="label" value="' . $label . '" />';
    }
    
   
    
    ?>
</div>
